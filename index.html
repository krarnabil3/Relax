<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</title>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Arial;
background:linear-gradient(180deg,#071c2a,#04101a);color:#fff}
.wrap{max-width:520px;margin:auto;padding:20px}
.card{background:rgba(255,255,255,.08);border-radius:22px;padding:18px;margin-bottom:16px;
backdrop-filter:blur(18px);border:1px solid rgba(255,255,255,.15)}
h1{margin:0 0 10px}
label{font-size:13px;opacity:.8}
input,button{width:100%;padding:14px;border-radius:16px;border:none;margin-top:8px;font-size:16px}
input{background:rgba(0,0,0,.25);color:#fff}
button{background:#0a84ff;color:#fff;font-weight:600}
.preview{width:100%;margin-top:10px;border-radius:16px}
.hidden{display:none}
</style>
</head>
<body>
<div class="wrap">

<div class="card">
<h1>ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ</h1>
<p>Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø´Ø±Ø§Ø¡ Ø¬Ù‡Ø§Ø² Ø£ØµÙ„ÙŠ Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù…Ø¯Ø© Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø´Ø±ÙƒØ© Ø§Ù„Ø¶Ù…Ø§Ù† Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©.</p>
</div>

<div class="card">
<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">

<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" inputmode="tel">

<label>ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
<input id="imgCamera" type="file" accept="image/*" capture="environment">
<input id="imgGallery" type="file" accept="image/*" class="hidden">

<button onclick="pickGallery()">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ</button>
<img id="preview" class="preview hidden">

<button onclick="activate()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</button>
</div>

<div class="card hidden" id="done">
<h2>âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ù…Ø§Ù†</h2>
<p id="endDate"></p>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {"apiKey": "AIzaSyBMZbRFRU5-GyAmEwLHDspnY6PkEcaz6Ak", "authDomain": "albaman-f8a20.firebaseapp.com", "projectId": "albaman-f8a20", "storageBucket": "albaman-f8a20.firebasestorage.app", "messagingSenderId": "770267943286", "appId": "1:770267943286:web:e3da1c43d65740d7b52a57"};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const WARRANTY_DAYS = 365;

let imageData = null;

function pickGallery(){
  document.getElementById("imgGallery").click();
}

function handleFile(file){
  const r=new FileReader();
  r.onload=e=>{
    imageData=e.target.result;
    const img=document.getElementById("preview");
    img.src=imageData; img.classList.remove("hidden");
  };
  r.readAsDataURL(file);
}

imgCamera.onchange=e=>handleFile(e.target.files[0]);
imgGallery.onchange=e=>handleFile(e.target.files[0]);

async function activate(){
  const name=nameEl.value.trim();
  const phone=phoneEl.value.trim();
  if(name.split(" ").length<3)return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ");
  if(phone.length<8)return alert("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­");
  if(!imageData)return alert("Ø§Ø±ÙÙ‚ ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©");

  const start=new Date();
  const end=new Date(start); end.setDate(end.getDate()+WARRANTY_DAYS);

  await db.collection("warranties").add({
    name, phone, imageData,
    startISO:start.toISOString(),
    endISO:end.toISOString(),
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });

  document.getElementById("done").classList.remove("hidden");
  document.getElementById("endDate").innerText="ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¶Ù…Ø§Ù† Ø¨ØªØ§Ø±ÙŠØ®: "+end.toLocaleDateString("ar");
}

const nameEl=document.getElementById("name");
const phoneEl=document.getElementById("phone");
</script>
</body>
</html>
